<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>html,body,#map{height:100%;margin:0;padding:0}</style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      const params = new URLSearchParams(location.search);
      const route = params.get('route');
      let coords = [];
      try{ coords = JSON.parse(route) }catch(e){ coords = [] }
      const map = L.map('map');
      if(coords && coords.length>0){
        const latlngs = coords.map(c=>[c.latitude, c.longitude]);
        map.setView(latlngs[Math.floor(latlngs.length/2)], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
        }).addTo(map);
        L.polyline(latlngs, {color:'purple'}).addTo(map);
        L.marker(latlngs[0]).addTo(map);
        L.marker(latlngs[latlngs.length-1]).addTo(map);
      } else {
        map.setView([-15.7801, -47.9292], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
        }).addTo(map);
      }
    </script>
  </body>
</html>
